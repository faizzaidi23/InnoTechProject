<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/innotechproject/CarControlScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/innotechproject/CarControlScreen.kt" />
              <option name="originalContent" value="package com.example.innotechproject&#10;&#10;import android.bluetooth.BluetoothDevice&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.automirrored.filled.ArrowForward&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;&#10;&#10;/**&#10; * Main screen for car control&#10; * Shows device selection and control buttons&#10; */&#10;@Composable&#10;fun CarControlScreen(modifier: Modifier = Modifier, viewModel: CarControlViewModel = viewModel()) {&#10;&#10;&#10;    val pairedDevices by viewModel.pairedDevices.collectAsState()&#10;    val isConnected by viewModel.isConnected.collectAsState()&#10;    val statusMessage by viewModel.statusMessage.collectAsState()&#10;    val selectedDevice by viewModel.selectedDevice.collectAsState()&#10;&#10;    val sliderPosition by viewModel.sliderPosition.collectAsState()&#10;&#10;&#10;&#10;    var showDeviceDialog by remember { mutableStateOf(false) }&#10;&#10;&#10;    LaunchedEffect(Unit) {&#10;        viewModel.loadPairedDevices()&#10;    }&#10;&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .background(MaterialTheme.colorScheme.background)&#10;            .padding(16.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;&#10;        // Header&#10;        Text(&#10;            text = &quot; Car Controller&quot;,&#10;            fontSize = 28.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = MaterialTheme.colorScheme.primary,&#10;            modifier = Modifier.padding(vertical = 16.dp)&#10;        )&#10;&#10;        // Connection Section&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(vertical = 8.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = if (isConnected)&#10;                    Color(0xFF4CAF50).copy(alpha = 0.1f)&#10;                else&#10;                    MaterialTheme.colorScheme.surfaceVariant&#10;            )&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(16.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                // Device selection button&#10;                Button(&#10;                    onClick = { showDeviceDialog = true },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    enabled = !isConnected&#10;                ) {&#10;                    Icon(Icons.Default.Settings, contentDescription = null)&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Text(&#10;                        text = try { selectedDevice?.name ?: &quot;Select Device&quot; } catch (_: SecurityException) { &quot;Select Device&quot; },&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;&#10;                Spacer(Modifier.height(12.dp))&#10;&#10;                // Connect/Disconnect button&#10;                Button(&#10;                    onClick = {&#10;                        if (isConnected) viewModel.disconnect()&#10;                        else viewModel.connect()&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = if (isConnected)&#10;                            Color(0xFFF44336)&#10;                        else&#10;                            MaterialTheme.colorScheme.primary&#10;                    ),&#10;                    enabled = selectedDevice != null&#10;                ) {&#10;                    Icon(&#10;                        if (isConnected) Icons.Default.Close else Icons.Default.Check,&#10;                        contentDescription = null&#10;                    )&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Text(&#10;                        text = if (isConnected) &quot;Disconnect&quot; else &quot;Connect&quot;,&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;&#10;                // Status message&#10;                Spacer(Modifier.height(12.dp))&#10;                Text(&#10;                    text = statusMessage,&#10;                    fontSize = 14.sp,&#10;                    color = if (isConnected) Color(0xFF4CAF50) else MaterialTheme.colorScheme.onSurfaceVariant,&#10;                    modifier = Modifier.padding(4.dp)&#10;                )&#10;            }&#10;        }&#10;&#10;        Spacer(Modifier.height(24.dp))&#10;&#10;        // Control Panel (only enabled when connected)&#10;        if (isConnected) {&#10;&#10;            ControlPanel(viewModel, sliderPosition)&#10;&#10;        } else {&#10;            // Show placeholder when not connected&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(1f),&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.3f)&#10;                )&#10;            ) {&#10;                Box(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Icon(&#10;                            Icons.Default.Warning,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(64.dp),&#10;                            tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.5f)&#10;                        )&#10;                        Spacer(Modifier.height(16.dp))&#10;                        Text(&#10;                            text = &quot;Connect to ESP32 to control the car&quot;,&#10;                            color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    // Device selector dialog&#10;    if (showDeviceDialog) {&#10;        DeviceSelectionDialog(&#10;            devices = pairedDevices,&#10;            selectedDevice = selectedDevice,&#10;            onDeviceSelected = { device -&gt;&#10;                viewModel.selectDevice(device)&#10;                showDeviceDialog = false&#10;            },&#10;            onDismiss = { showDeviceDialog = false },&#10;            onRefresh = { viewModel.loadPairedDevices() }&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Control panel with directional buttons&#10; * D-pad style layout: Forward, Back, Left, Right, Stop&#10; */&#10;@Composable&#10;&#10;fun ControlPanel(viewModel: CarControlViewModel, sliderPosition: Float) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = &quot;Car Controls&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                modifier = Modifier.padding(bottom = 24.dp)&#10;            )&#10;&#10;            // --- NEW CODE START ---&#10;            Text(&#10;                text = &quot;Speed Control&quot;,&#10;                fontSize = 16.sp,&#10;                fontWeight = FontWeight.Medium,&#10;            )&#10;//            Slider(&#10;//                value = sliderPosition,&#10;//                onValueChange = { viewModel.onSpeedChanged(it) },&#10;//                modifier = Modifier.padding(horizontal = 16.dp),&#10;//                steps = 9 // This creates 11 steps (0 to 10)&#10;//            )&#10;            Spacer(Modifier.height(24.dp))&#10;            // --- NEW CODE END ---&#10;&#10;&#10;            // Forward button (top)&#10;            ControlButton(&#10;                icon = Icons.Default.KeyboardArrowUp,&#10;                label = &quot;Forward&quot;,&#10;                onClick = { viewModel.moveForward() },&#10;                modifier = Modifier.size(80.dp)&#10;            )&#10;&#10;            Spacer(Modifier.height(16.dp))&#10;&#10;            // Left, Stop, Right (middle row)&#10;            Row(&#10;                horizontalArrangement = Arrangement.spacedBy(16.dp),&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                ControlButton(&#10;                    icon = Icons.AutoMirrored.Filled.ArrowBack,&#10;                    label = &quot;Left&quot;,&#10;                    onClick = { viewModel.turnLeft() },&#10;                    modifier = Modifier.size(80.dp)&#10;                )&#10;&#10;                ControlButton(&#10;                    icon = Icons.Default.Close,&#10;                    label = &quot;Stop&quot;,&#10;                    onClick = { viewModel.stop() },&#10;                    modifier = Modifier.size(80.dp),&#10;                    containerColor = Color(0xFFF44336)&#10;                )&#10;&#10;                ControlButton(&#10;                    icon = Icons.AutoMirrored.Filled.ArrowForward,&#10;                    label = &quot;Right&quot;,&#10;                    onClick = { viewModel.turnRight() },&#10;                    modifier = Modifier.size(80.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(Modifier.height(16.dp))&#10;&#10;            // Backward button (bottom)&#10;            ControlButton(&#10;                icon = Icons.Default.KeyboardArrowDown,&#10;                label = &quot;Backward&quot;,&#10;                onClick = { viewModel.moveBackward() },&#10;                modifier = Modifier.size(80.dp)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Reusable control button component&#10; */&#10;@Composable&#10;fun ControlButton(&#10;    icon: ImageVector,&#10;    label: String,&#10;    onClick: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    containerColor: Color = MaterialTheme.colorScheme.primary&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        modifier = Modifier.clickable(onClick = onClick)&#10;    ) {&#10;        Surface(&#10;            modifier = modifier.clip(CircleShape),&#10;            color = containerColor,&#10;            shadowElevation = 4.dp&#10;        ) {&#10;            Box(&#10;                contentAlignment = Alignment.Center,&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = label,&#10;                    modifier = Modifier.size(40.dp),&#10;                    tint = Color.White&#10;                )&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = MaterialTheme.colorScheme.onBackground&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Dialog to select Bluetooth device from paired list&#10; */&#10;@Composable&#10;fun DeviceSelectionDialog(&#10;    devices: List&lt;BluetoothDevice&gt;,&#10;    selectedDevice: BluetoothDevice?,&#10;    onDeviceSelected: (BluetoothDevice) -&gt; Unit,&#10;    onDismiss: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit&#10;) {&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        title = { Text(&quot;Select ESP32 Device&quot;) },&#10;        text = {&#10;            Column {&#10;                if (devices.isEmpty()) {&#10;                    Text(&#10;                        &quot;No paired devices found. Please pair your ESP32 in Android Bluetooth settings first.&quot;,&#10;                        color = MaterialTheme.colorScheme.error&#10;                    )&#10;                } else {&#10;                    LazyColumn {&#10;                        items(devices) { device -&gt;&#10;                            DeviceListItem(&#10;                                device = device,&#10;                                isSelected = device.address == selectedDevice?.address,&#10;                                onClick = { onDeviceSelected(device) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        },&#10;        confirmButton = {&#10;            TextButton(onClick = onRefresh) {&#10;                Text(&quot;Refresh&quot;)&#10;            }&#10;        },&#10;        dismissButton = {&#10;            TextButton(onClick = onDismiss) {&#10;                Text(&quot;Cancel&quot;)&#10;            }&#10;        }&#10;    )&#10;}&#10;&#10;/**&#10; * Single device item in the list&#10; */&#10;@Composable&#10;fun DeviceListItem(&#10;    device: BluetoothDevice,&#10;    isSelected: Boolean,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 4.dp)&#10;            .clickable(onClick = onClick),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = if (isSelected)&#10;                MaterialTheme.colorScheme.primaryContainer&#10;            else&#10;                MaterialTheme.colorScheme.surface&#10;        ),&#10;        border = if (isSelected)&#10;            androidx.compose.foundation.BorderStroke(2.dp, MaterialTheme.colorScheme.primary)&#10;        else null&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Icon(&#10;                Icons.Default.Settings,&#10;                contentDescription = null,&#10;                tint = if (isSelected)&#10;                    MaterialTheme.colorScheme.primary&#10;                else&#10;                    MaterialTheme.colorScheme.onSurface&#10;            )&#10;            Spacer(Modifier.width(16.dp))&#10;            Column {&#10;                Text(&#10;                    text = try { device.name ?: &quot;Unknown Device&quot; } catch (_: SecurityException) { &quot;Unknown Device&quot; },&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = if (isSelected)&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onSurface&#10;                )&#10;                Text(&#10;                    text = device.address,&#10;                    fontSize = 12.sp,&#10;                    color = if (isSelected)&#10;                        MaterialTheme.colorScheme.onPrimaryContainer.copy(alpha = 0.7f)&#10;                    else&#10;                        MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package com.example.innotechproject&#10;&#10;import android.bluetooth.BluetoothDevice&#10;import androidx.compose.foundation.background&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.gestures.detectTapGestures&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.foundation.shape.CircleShape&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.ArrowBack&#10;import androidx.compose.material.icons.automirrored.filled.ArrowForward&#10;import androidx.compose.material.icons.filled.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.draw.clip&#10;import androidx.compose.ui.graphics.Color&#10;import androidx.compose.ui.graphics.vector.ImageVector&#10;import androidx.compose.ui.input.pointer.pointerInput&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import androidx.compose.ui.unit.sp&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;&#10;&#10;/**&#10; * Main screen for car control&#10; * Shows device selection and control buttons&#10; */&#10;@Composable&#10;fun CarControlScreen(modifier: Modifier = Modifier, viewModel: CarControlViewModel = viewModel()) {&#10;&#10;&#10;    val pairedDevices by viewModel.pairedDevices.collectAsState()&#10;    val isConnected by viewModel.isConnected.collectAsState()&#10;    val statusMessage by viewModel.statusMessage.collectAsState()&#10;    val selectedDevice by viewModel.selectedDevice.collectAsState()&#10;&#10;    val sliderPosition by viewModel.sliderPosition.collectAsState()&#10;&#10;&#10;&#10;    var showDeviceDialog by remember { mutableStateOf(false) }&#10;&#10;&#10;    LaunchedEffect(Unit) {&#10;        viewModel.loadPairedDevices()&#10;    }&#10;&#10;    Column(&#10;        modifier = modifier&#10;            .fillMaxSize()&#10;            .background(MaterialTheme.colorScheme.background)&#10;            .padding(16.dp),&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;&#10;        // Header&#10;        Text(&#10;            text = &quot; Car Controller&quot;,&#10;            fontSize = 28.sp,&#10;            fontWeight = FontWeight.Bold,&#10;            color = MaterialTheme.colorScheme.primary,&#10;            modifier = Modifier.padding(vertical = 16.dp)&#10;        )&#10;&#10;        // Connection Section&#10;        Card(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(vertical = 8.dp),&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = if (isConnected)&#10;                    Color(0xFF4CAF50).copy(alpha = 0.1f)&#10;                else&#10;                    MaterialTheme.colorScheme.surfaceVariant&#10;            )&#10;        ) {&#10;            Column(&#10;                modifier = Modifier.padding(16.dp),&#10;                horizontalAlignment = Alignment.CenterHorizontally&#10;            ) {&#10;                // Device selection button&#10;                Button(&#10;                    onClick = { showDeviceDialog = true },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    enabled = !isConnected&#10;                ) {&#10;                    Icon(Icons.Default.Settings, contentDescription = null)&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Text(&#10;                        text = try { selectedDevice?.name ?: &quot;Select Device&quot; } catch (_: SecurityException) { &quot;Select Device&quot; },&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;&#10;                Spacer(Modifier.height(12.dp))&#10;&#10;                // Connect/Disconnect button&#10;                Button(&#10;                    onClick = {&#10;                        if (isConnected) viewModel.disconnect()&#10;                        else viewModel.connect()&#10;                    },&#10;                    modifier = Modifier.fillMaxWidth(),&#10;                    colors = ButtonDefaults.buttonColors(&#10;                        containerColor = if (isConnected)&#10;                            Color(0xFFF44336)&#10;                        else&#10;                            MaterialTheme.colorScheme.primary&#10;                    ),&#10;                    enabled = selectedDevice != null&#10;                ) {&#10;                    Icon(&#10;                        if (isConnected) Icons.Default.Close else Icons.Default.Check,&#10;                        contentDescription = null&#10;                    )&#10;                    Spacer(Modifier.width(8.dp))&#10;                    Text(&#10;                        text = if (isConnected) &quot;Disconnect&quot; else &quot;Connect&quot;,&#10;                        fontSize = 16.sp&#10;                    )&#10;                }&#10;&#10;                // Status message&#10;                Spacer(Modifier.height(12.dp))&#10;                Text(&#10;                    text = statusMessage,&#10;                    fontSize = 14.sp,&#10;                    color = if (isConnected) Color(0xFF4CAF50) else MaterialTheme.colorScheme.onSurfaceVariant,&#10;                    modifier = Modifier.padding(4.dp)&#10;                )&#10;            }&#10;        }&#10;&#10;        Spacer(Modifier.height(24.dp))&#10;&#10;        // Control Panel (only enabled when connected)&#10;        if (isConnected) {&#10;&#10;            ControlPanel(viewModel, sliderPosition)&#10;&#10;        } else {&#10;            // Show placeholder when not connected&#10;            Card(&#10;                modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .weight(1f),&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.3f)&#10;                )&#10;            ) {&#10;                Box(&#10;                    modifier = Modifier.fillMaxSize(),&#10;                    contentAlignment = Alignment.Center&#10;                ) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Icon(&#10;                            Icons.Default.Warning,&#10;                            contentDescription = null,&#10;                            modifier = Modifier.size(64.dp),&#10;                            tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.5f)&#10;                        )&#10;                        Spacer(Modifier.height(16.dp))&#10;                        Text(&#10;                            text = &quot;Connect to ESP32 to control the car&quot;,&#10;                            color = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.7f)&#10;                        )&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    // Device selector dialog&#10;    if (showDeviceDialog) {&#10;        DeviceSelectionDialog(&#10;            devices = pairedDevices,&#10;            selectedDevice = selectedDevice,&#10;            onDeviceSelected = { device -&gt;&#10;                viewModel.selectDevice(device)&#10;                showDeviceDialog = false&#10;            },&#10;            onDismiss = { showDeviceDialog = false },&#10;            onRefresh = { viewModel.loadPairedDevices() }&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Control panel with directional buttons&#10; * D-pad style layout: Forward, Back, Left, Right, Stop&#10; * Buttons use press/hold functionality - car moves while button is held&#10; */&#10;@Composable&#10;fun ControlPanel(viewModel: CarControlViewModel, sliderPosition: Float) {&#10;    Card(&#10;        modifier = Modifier.fillMaxWidth(),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = MaterialTheme.colorScheme.surface&#10;        ),&#10;        elevation = CardDefaults.cardElevation(defaultElevation = 4.dp)&#10;    ) {&#10;        Column(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(24.dp),&#10;            horizontalAlignment = Alignment.CenterHorizontally&#10;        ) {&#10;            Text(&#10;                text = &quot;Car Controls&quot;,&#10;                fontSize = 20.sp,&#10;                fontWeight = FontWeight.Bold,&#10;                modifier = Modifier.padding(bottom = 24.dp)&#10;            )&#10;&#10;            Text(&#10;                text = &quot;Hold buttons to move&quot;,&#10;                fontSize = 14.sp,&#10;                color = MaterialTheme.colorScheme.onSurfaceVariant,&#10;                modifier = Modifier.padding(bottom = 16.dp)&#10;            )&#10;&#10;            // Forward button (top)&#10;            HoldControlButton(&#10;                icon = Icons.Default.KeyboardArrowUp,&#10;                label = &quot;Forward&quot;,&#10;                onPress = { viewModel.moveForward() },&#10;                onRelease = { viewModel.stop() },&#10;                modifier = Modifier.size(80.dp)&#10;            )&#10;&#10;            Spacer(Modifier.height(16.dp))&#10;&#10;            // Left, Stop, Right (middle row)&#10;            Row(&#10;                horizontalArrangement = Arrangement.spacedBy(16.dp),&#10;                verticalAlignment = Alignment.CenterVertically&#10;            ) {&#10;                HoldControlButton(&#10;                    icon = Icons.AutoMirrored.Filled.ArrowBack,&#10;                    label = &quot;Left&quot;,&#10;                    onPress = { viewModel.turnLeft() },&#10;                    onRelease = { viewModel.stop() },&#10;                    modifier = Modifier.size(80.dp)&#10;                )&#10;&#10;                ControlButton(&#10;                    icon = Icons.Default.Close,&#10;                    label = &quot;Stop&quot;,&#10;                    onClick = { viewModel.stop() },&#10;                    modifier = Modifier.size(80.dp),&#10;                    containerColor = Color(0xFFF44336)&#10;                )&#10;&#10;                HoldControlButton(&#10;                    icon = Icons.AutoMirrored.Filled.ArrowForward,&#10;                    label = &quot;Right&quot;,&#10;                    onPress = { viewModel.turnRight() },&#10;                    onRelease = { viewModel.stop() },&#10;                    modifier = Modifier.size(80.dp)&#10;                )&#10;            }&#10;&#10;            Spacer(Modifier.height(16.dp))&#10;&#10;            // Backward button (bottom)&#10;            HoldControlButton(&#10;                icon = Icons.Default.KeyboardArrowDown,&#10;                label = &quot;Backward&quot;,&#10;                onPress = { viewModel.moveBackward() },&#10;                onRelease = { viewModel.stop() },&#10;                modifier = Modifier.size(80.dp)&#10;            )&#10;        }&#10;    }&#10;}&#10;&#10;/**&#10; * Hold-to-move control button component&#10; * Sends command when pressed and stop command when released&#10; */&#10;@Composable&#10;fun HoldControlButton(&#10;    icon: ImageVector,&#10;    label: String,&#10;    onPress: () -&gt; Unit,&#10;    onRelease: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    containerColor: Color = Color.Black&#10;) {&#10;    // Track if button is currently pressed&#10;    var isPressed by remember { mutableStateOf(false) }&#10;&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally&#10;    ) {&#10;        Surface(&#10;            modifier = modifier&#10;                .clip(CircleShape)&#10;                .pointerInput(Unit) {&#10;                    detectTapGestures(&#10;                        onPress = {&#10;                            // Button pressed down&#10;                            isPressed = true&#10;                            onPress()&#10;                            // Wait for button release&#10;                            tryAwaitRelease()&#10;                            // Button released&#10;                            isPressed = false&#10;                            onRelease()&#10;                        }&#10;                    )&#10;                },&#10;            color = if (isPressed) containerColor.copy(alpha = 0.7f) else containerColor,&#10;            shadowElevation = if (isPressed) 2.dp else 4.dp&#10;        ) {&#10;            Box(&#10;                contentAlignment = Alignment.Center,&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = label,&#10;                    modifier = Modifier.size(40.dp),&#10;                    tint = Color.White&#10;                )&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Black,&#10;            fontWeight = if (isPressed) FontWeight.Bold else FontWeight.Normal&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Reusable control button component (for Stop button - single click)&#10; */&#10;@Composable&#10;fun ControlButton(&#10;    icon: ImageVector,&#10;    label: String,&#10;    onClick: () -&gt; Unit,&#10;    modifier: Modifier = Modifier,&#10;    containerColor: Color = Color.Black&#10;) {&#10;    Column(&#10;        horizontalAlignment = Alignment.CenterHorizontally,&#10;        modifier = Modifier.clickable(onClick = onClick)&#10;    ) {&#10;        Surface(&#10;            modifier = modifier.clip(CircleShape),&#10;            color = containerColor,&#10;            shadowElevation = 4.dp&#10;        ) {&#10;            Box(&#10;                contentAlignment = Alignment.Center,&#10;                modifier = Modifier.fillMaxSize()&#10;            ) {&#10;                Icon(&#10;                    imageVector = icon,&#10;                    contentDescription = label,&#10;                    modifier = Modifier.size(40.dp),&#10;                    tint = Color.White&#10;                )&#10;            }&#10;        }&#10;        Spacer(Modifier.height(8.dp))&#10;        Text(&#10;            text = label,&#10;            fontSize = 12.sp,&#10;            color = Color.Black&#10;        )&#10;    }&#10;}&#10;&#10;/**&#10; * Dialog to select Bluetooth device from paired list&#10; */&#10;@Composable&#10;fun DeviceSelectionDialog(&#10;    devices: List&lt;BluetoothDevice&gt;,&#10;    selectedDevice: BluetoothDevice?,&#10;    onDeviceSelected: (BluetoothDevice) -&gt; Unit,&#10;    onDismiss: () -&gt; Unit,&#10;    onRefresh: () -&gt; Unit&#10;) {&#10;    AlertDialog(&#10;        onDismissRequest = onDismiss,&#10;        title = { Text(&quot;Select ESP32 Device&quot;) },&#10;        text = {&#10;            Column {&#10;                if (devices.isEmpty()) {&#10;                    Text(&#10;                        &quot;No paired devices found. Please pair your ESP32 in Android Bluetooth settings first.&quot;,&#10;                        color = MaterialTheme.colorScheme.error&#10;                    )&#10;                } else {&#10;                    LazyColumn {&#10;                        items(devices) { device -&gt;&#10;                            DeviceListItem(&#10;                                device = device,&#10;                                isSelected = device.address == selectedDevice?.address,&#10;                                onClick = { onDeviceSelected(device) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        },&#10;        confirmButton = {&#10;            TextButton(onClick = onRefresh) {&#10;                Text(&quot;Refresh&quot;)&#10;            }&#10;        },&#10;        dismissButton = {&#10;            TextButton(onClick = onDismiss) {&#10;                Text(&quot;Cancel&quot;)&#10;            }&#10;        }&#10;    )&#10;}&#10;&#10;/**&#10; * Single device item in the list&#10; */&#10;@Composable&#10;fun DeviceListItem(&#10;    device: BluetoothDevice,&#10;    isSelected: Boolean,&#10;    onClick: () -&gt; Unit&#10;) {&#10;    Card(&#10;        modifier = Modifier&#10;            .fillMaxWidth()&#10;            .padding(vertical = 4.dp)&#10;            .clickable(onClick = onClick),&#10;        colors = CardDefaults.cardColors(&#10;            containerColor = if (isSelected)&#10;                MaterialTheme.colorScheme.primaryContainer&#10;            else&#10;                MaterialTheme.colorScheme.surface&#10;        ),&#10;        border = if (isSelected)&#10;            androidx.compose.foundation.BorderStroke(2.dp, MaterialTheme.colorScheme.primary)&#10;        else null&#10;    ) {&#10;        Row(&#10;            modifier = Modifier&#10;                .fillMaxWidth()&#10;                .padding(16.dp),&#10;            verticalAlignment = Alignment.CenterVertically&#10;        ) {&#10;            Icon(&#10;                Icons.Default.Settings,&#10;                contentDescription = null,&#10;                tint = if (isSelected)&#10;                    MaterialTheme.colorScheme.primary&#10;                else&#10;                    MaterialTheme.colorScheme.onSurface&#10;            )&#10;            Spacer(Modifier.width(16.dp))&#10;            Column {&#10;                Text(&#10;                    text = try { device.name ?: &quot;Unknown Device&quot; } catch (_: SecurityException) { &quot;Unknown Device&quot; },&#10;                    fontWeight = FontWeight.Bold,&#10;                    color = if (isSelected)&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onSurface&#10;                )&#10;                Text(&#10;                    text = device.address,&#10;                    fontSize = 12.sp,&#10;                    color = if (isSelected)&#10;                        MaterialTheme.colorScheme.onPrimaryContainer.copy(alpha = 0.7f)&#10;                    else&#10;                        MaterialTheme.colorScheme.onSurface.copy(alpha = 0.7f)&#10;                )&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>